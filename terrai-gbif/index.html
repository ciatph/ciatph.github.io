
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="images/icons/ciat-icon-48.ico">

    <title>Terra-i and GBIF</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/main.css" rel="stylesheet">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    <script src="js/legend.js" type="text/javascript"></script>
    <script src="js/map.js" type="text/javascript"></script>  
  </head>

  <body>

    <nav class="site-header sticky-top py-1">
      <div class="container d-flex flex-column flex-md-row justify-content">
        <a class="py-2" href="#">
          <img src="images/logo/ciat-icon-48.png" width="30" height="30"/>
        </a> &nbsp; &nbsp;  &nbsp; 
        <a class="py-2 d-none d-md-inline-block" href="#">Latin America</a> &nbsp; &nbsp;  &nbsp;
        <a class="py-2 d-none d-md-inline-block" href="#">Asia</a>

      </div>
    </nav>

    <div id="mapid"></div>

      <div class="container" style="margin-top: 40px">
        <h1 id="page_header">Latin America</h1>

        <hr>

        <!-- Example row of columns -->
        <div class="row">
            <!-- insert layer text here -->
        </div>

        <hr><br>

      </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="js/bootstrap.min.js"></script>

<script>
    var map;
    var basemap;
    var mapLatin;
    var legend;
    var scale;
    var layerToggle;
    var text;
    var t;
    var caption;

    var createDescriptions = function(){
        $.ajax({
            url: 'js/descriptions.json',
            success: function(j){
                text = j;
                console.log('loaded!');

                for(var i in j){
                    var note = $('<div class="col-md-4">');
                    var h1 = $('<h3>');
                    h1.text(j[i].label);
                    note.append(h1);

                    var p = $('<p>');
                    p.text(j[i].description);
                    note.append(p);  
                    $('.row').append(note);                  
                }
            }
        });
    };

    /**
     * Remove all current map layers and widgets 
     */
    var removeLayers = function(submap){
        for(var i in submap){
            console.log(i)
            map.removeLayer(submap[i]);
        }

        map.removeControl(layerToggle);
        map.removeControl(legend);
        map.removeControl(scale);
    
    };


    /**
     * Display the controls and layers of a deactivated map
     */ 
    var activateMap = function(submap){
        var baseMaps = {
            "Latin America Base Map": basemap
        };

        // add layer toggle
        layerToggle = L.control.layers(baseMaps, submap.getOverlays()).addTo(map);

        // add scale
        scale = L.control.scale().addTo(map);

        // add legend
        legend = createLegend().addTo(map);
    };    


    var initLatinAmerica = function(basemap){
        mapLatin = new Map();
        mapLatin.init([-26.11598592533351, -81.91406250000001], 4);        

        mapLatin.addLayer({
            name: 'latin_base', layers: 'terrai-gbif:latin_terra_I_resamp_fromedit',
            attribution: 'Terra-i resampled', styles: 'terrai-base' 
        });

        mapLatin.addLayer({
            name: 'p_andina', layers: 'terrai-gbif:p_andina',
            attribution: 'Prumnopitys andina', styles: 'terrai-species'
        });    
        
        mapLatin.addLayer({
            name: 'p_salignus', layers: 'terrai-gbif:podocarpus_salignus',
            attribution: 'Podocarpus salignus', styles: 'terrai-species-2'
        });          

        mapLatin.addLayer({
            name: 'p_uviferum', layers: 'terrai-gbif:pilgerodendron_uviferum',
            attribution: 'Pilgerodendron uviferum', styles: 'terrai-species-3'
        });           
        
        mapLatin.addLayer({
            name: 'p_andina_add', layers: 'terrai-gbif:p_andina_add',
            attribution: 'Prumnopitys andina add', styles: 'terrai-species'
        });     
        
        mapLatin.addLayer({
            name: 'p_salignus_add', layers: 'terrai-gbif:p_salignus_add',
            attribution: 'Podocarpus salignus add', styles: 'terrai-species-2'
        });     
        
        mapLatin.addLayer({
            name: 'p_uviferum_add', layers: 'terrai-gbif:p_uviferum_add',
            attribution: 'Pilgerodendron uviferum add', styles: 'terrai-species-3'
        });           
        
        var baseMaps = {
            "Latin America Base Map": basemap
        };

        // main map
        map = L.map('mapid', {
            center: mapLatin.center,
            zoom: mapLatin.zoom,
            layers: [basemap]
        });    

        // add layer toggle
        layerToggle = L.control.layers(baseMaps, mapLatin.getOverlays()).addTo(map);

        // add scale
        scale = L.control.scale().addTo(map);

        // add legend
        legend = createLegend().addTo(map);

        // add layer caption
        map.on('layeradd', function(e){
            t = e;
            console.log('added layer ' + e.layer.getAttribution());

            if(caption !== undefined)
                map.removeControl(caption);

            caption = createCaption(text[e.layer.getAttribution()]).addTo(map);
        });

        // remove layer caption
        map.on('layerremove', function(e){
            if(caption !== undefined)
                map.removeControl(caption);
        });
    };

    window.onload = function(){
        // set window fullscreen height
        var mapDom = document.getElementById('mapid');
        mapDom.style.height = window.innerHeight/1.3 + 'px';

        // add OpenStreetMap basemap
        basemap = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        });

        initLatinAmerica(basemap);
        createDescriptions();
    };

</script>


<script src="js/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
  </body>
</html>
