<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.39.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }

        #info {
            display: block;
            position: relative;
            margin: 0px auto;
            width: 50%;
            padding: 10px;
            border: none;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
            color: #222;
            background: #fff;
        }           
    </style>
</head>
<body>

<!-- map entry -->
<div id='map'></div>

<!-- longtitude, latitude display -->
<pre id='info'></pre>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2lhdHBoIiwiYSI6ImNqNXcyeTNhcTA5MzEycHFpdG90enFxMG8ifQ.gwZ6uo6pvx4-RZ1lHODcBQ';
    var map = new mapboxgl.Map({
        container: 'map',
        // style: 'mapbox://styles/mapbox/streets-v9',
        // style that uses a GeoJSON datasource "cj64in9zo1ksx32mr7ke3g7vb"
        style: 'mapbox://styles/ciatph/cj64iqv9q5g0j2spa216a6f7r',  // amia-lowres-style
        zoom: 5.5,
        center: [122.016, 12.127]
    })
    .addControl(new mapboxgl.NavigationControl())
    .addControl(new mapboxgl.AttributionControl({ compact: true }));

    map.on('load', function (e) {
        // Add a layer showing the state polygons.
        // This data source is already being used (and loaded?) for "amia-lowres-style" style
        // Only used for coloring hover effect. Data informatiion be retrieved from styles alone
        map.addSource("dataSource", {
            "type": "geojson",
            'data': 'https://api.mapbox.com/datasets/v1/ciatph/cj64in9zo1ksx32mr7ke3g7vb/features?access_token=pk.eyJ1IjoiY2lhdHBoIiwiYSI6ImNqNXcyeTNhcTA5MzEycHFpdG90enFxMG8ifQ.gwZ6uo6pvx4-RZ1lHODcBQ'
        });    

        // add layer to color the raw source data
        map.addLayer({
            'id': 'municipalities',
            "type": "fill",
            "source": "dataSource",
            "layout": {},
            "paint": {
                "fill-color": "#627BC1",
                "fill-opacity": 0.5
            }
        });

        // add a conditional layer to play over the source data on hover event
        map.addLayer({
            "id": "state-fills-hover",
            "type": "fill",
            "source": "dataSource",
            "layout": {},
            "paint": {
                "fill-color": "#ff4",
                "fill-opacity": 1
             },
             "filter": ["==", "MUNI_CITY", ""]
        });        


    // display coordinates on mouse hover, for the layer "municipalities"
    map.on('mousemove', 'municipalities', function(e){
        document.getElementById('info').innerHTML = JSON.stringify(e.point) + "<br>" + JSON.stringify(e.lngLat);
        map.setFilter("state-fills-hover", ["==", "MUNI_CITY", e.features[0].properties.MUNI_CITY]);        
    });

    // display municipality name on mouse-click
    map.on('click', 'municipalities', function (e) {
        // print all data
        var content = "";
        for(key in e.features[0].properties){
            content += key + ": " + e.features[0].properties[key];
            content += "<br>";
        }

        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(content)
            .addTo(map);      
    });    
});
</script>

</body>
</html>